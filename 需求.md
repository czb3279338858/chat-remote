# 移动端聊天控制多类型实例 —— 最终完整需求
## 一、核心目标
通过手机聊天软件，统一管理 PC 上**多种交互式/非交互式实例**，指令简洁、异常提示明确、全程无鉴权、纯透传交互。

## 二、实例基础信息
每个实例包含以下核心属性：
| 字段 | 说明 |
|------|------|
| 自增数字 ID | 唯一、不可修改，作为实例核心标识 |
| 实例类型 | 如 qodercli、node、python、ssh 等 |
| 类型说明 | 简短描述该类型用途（展示在 `/help` 中） |
| 用户备注 | 自定义用途标签，支持后期修改 |
| 启动参数 | 各类型实例自定义，创建时传入 |
| 运行模式 | 交互式 / 非交互式 |
| 运行状态 | 运行中（空闲 / 忙碌）、已退出 |

## 三、实例运行模式规则
### 1. 交互式实例（如 qodercli、ssh）
- 启动后持续运行，支持多次接收输入、返回输出；
- 需手动 `/kill ID` 关闭，或异常退出；
- 运行中始终显示在 `/list` 中。

### 2. 非交互式实例（如 node、python）
- 启动 → 自动运行 → 输出全部结果 → 自动结束；
- 运行过程中不接受任何外部输入（`/ID 内容`/纯文本均拒绝）；
- 结束后自动从 `/list` 移除，记入 `/log`（退出原因标记为“正常结束”）。

## 四、指令全集（含功能+异常规则）
### 1. `/help`
- **功能**：返回所有指令用法 + 支持的实例类型（含类型说明） + 示例命令；
- **异常场景**：无（该指令无入参，始终返回完整帮助信息）。

### 2. `/new 类型 备注 [参数...]`
- **功能**：创建指定类型实例，参数由对应类型定义；
- **异常场景**：
  - 缺失「类型」或「备注」：提示格式错误 + 正确示例；
  - 类型不支持：提示当前支持的实例类型列表；
  - 参数格式错误：提示该类型参数示例。

### 3. `/list`
- **功能**：列出所有运行中的实例，展示内容为「ID + 类型 + 备注 + 状态（空闲/忙碌+耗时）」；
- **异常场景**：无运行中实例 → 提示“暂无运行中的实例”。

### 4. `/log`
- **功能**：查看最近已退出实例记录，展示内容为「原ID + 类型 + 备注 + 退出时间 + 退出原因」；
- **异常场景**：无退出记录 → 提示“暂无已退出实例记录”。

### 5. `/rename ID 新备注`
- **功能**：修改指定实例的备注；
- **异常场景**：
  - ID 不存在/已退出：提示“实例ID不存在！可通过 `/list` 查看运行中的实例”；
  - 缺失「新备注」：提示格式错误 + 正确示例。

### 6. `/use ID`
- **功能**：设置默认操作实例，后续无 ID 前缀的纯文本消息默认发给该实例；
- **异常场景**：
  - ID 不存在/已退出：提示“实例ID不存在！可通过 `/list` 查看运行中的实例”；
  - 缺失「ID」：提示格式错误 + 正确示例。

### 7. `/ID 内容`
- **功能**：向指定 ID 实例发送交互内容；
- **允许发送条件**：实例存在且运行中 + 实例为交互式；
- **异常场景**：
  - ID 不存在/已退出：提示“实例ID不存在！可通过 `/list` 查看运行中的实例”；
  - 实例为非交互式：提示“该实例为非交互式，不支持接收手动指令”；
  - 缺失「内容」：提示格式错误 + 正确示例。

### 8. 纯文本消息（无 `/ID` 前缀）
- **功能**：发送给已设置的默认实例；
- **异常场景**：
  - 未设置默认实例：提示“未指定实例！可通过 `/use ID` 设置默认，或 `/ID 内容` 直接指定”；
  - 默认实例不存在/已退出：提示“默认实例已失效！请重新通过 `/use ID` 切换”；
  - 默认实例为非交互式：提示“默认实例为非交互式，不支持接收手动指令”。

### 9. `/kill ID`
- **功能**：关闭指定实例；
- **异常场景**：
  - ID 不存在/已退出：提示“实例ID不存在！可通过 `/list` 查看运行中的实例”；
  - 缺失「ID」：提示格式错误 + 正确示例。

### 10. `/killall [类型]`
- **功能**：无参数时关闭所有实例，带参数时仅关闭指定类型的所有实例；
- **异常场景**：
  - 无运行中实例：提示“暂无运行中的实例可关闭”；
  - 指定类型不支持：提示当前支持的实例类型列表。

## 五、全局统一规则
1. 所有指令异常提示需包含「错误原因 + 解决方案/示例」，而非仅告知“错误”；
2. 非交互式实例一律拒绝接收任何手动输入（`/ID 内容` 或纯文本消息）；
3. 实例退出后自动从 `/list` 移除，并记录退出时间、原因至 `/log`；
4. 全程无鉴权、无用户区分，所有操作纯透传；
5. 指令支持基础容错：多空格自动合并、大小写自动转为小写。